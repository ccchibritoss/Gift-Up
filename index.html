<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Up - –ê—Ä–µ–Ω–¥–∞ NFT</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –ù–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="config.js"></script>
    <script src="supabase-client.js"></script>
    <script src="telegram-bot.js"></script>
    <script src="auth-system.js"></script>
    
    <style>
        /* –í–°–¢–ê–í–¨ –°–Æ–î–ê –í–ï–°–¨ CSS –ò–ó –ü–†–ï–î–´–î–£–©–ò–• –û–¢–í–ï–¢–û–í */
        /* ... –ø–æ–ª–Ω—ã–π CSS –∫–æ–¥ ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- –í–∫–ª–∞–¥–∫–∞ –ê—Ä–µ–Ω–¥–∞ -->
        <div id="rent" class="tab-content active">
            <div style="text-align: center; margin-bottom: 20px;">
                <h1 style="color: #0074D9;">üéÅ Gift Up</h1>
                <p style="color: #B0B0B0;">–ê—Ä–µ–Ω–¥–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö NFT –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                <button onclick="showBotCommands()" class="btn-secondary" style="margin-top: 10px;">
                    ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
                </button>
            </div>
            <div id="giftsList" class="gifts-grid"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile" class="tab-content">
            <div class="profile-section">
                <div class="avatar" id="userAvatar">üë§</div>
                <h3 id="userName">–ó–∞–≥—Ä—É–∑–∫–∞... <span id="adminBadge" class="admin-badge" style="display: none;">ADMIN</span></h3>
                
                <div class="info-card">
                    <div class="info-item">
                        <span>–ë–∞–ª–∞–Ω—Å:</span>
                        <strong id="balance">0 TON</strong>
                    </div>
                    
                    <div class="info-item">
                        <span>Telegram:</span>
                        <span id="telegramStatus" class="status-disconnected">–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω</span>
                    </div>
                    
                    <div class="info-item">
                        <span>–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                        <span id="phoneDisplay">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                    </div>
                </div>

                <div class="buttons-container">
                    <button class="btn-primary" onclick="bindTelegram()" id="bindTelegramBtn">
                        üì± –ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram
                    </button>
                    <button class="btn-secondary" onclick="showPhoneModal()">
                        üìû –ü—Ä–∏–≤—è–∑–∞—Ç—å –Ω–æ–º–µ—Ä
                    </button>
                </div>

                <div class="stats-section">
                    <h4 style="color: #0074D9; margin-bottom: 15px;">üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="rentedGifts">0</div>
                            <div class="stat-label">–ê—Ä–µ–Ω–¥–æ–≤–∞–Ω–æ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="myGifts">0</div>
                            <div class="stat-label">–ú–æ–∏ –ø–æ–¥–∞—Ä–∫–∏</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('rent')">
            <div class="nav-icon">üè†</div>
            <span>–ê—Ä–µ–Ω–¥–∞</span>
        </div>
        <div class="nav-item" onclick="switchTab('profile')">
            <div class="nav-icon">üë§</div>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ -->
    <div id="botModal" class="modal">
        <div class="modal-content">
            <h3>ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞</h3>
            <div style="text-align: left; margin: 15px 0;">
                <p><strong>–î–ª—è –≤—Å–µ—Ö:</strong></p>
                <p>üìã <strong>/gifts</strong> - –°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                <p>üìä <strong>/stats</strong> - –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
                
                <p style="margin-top: 15px;"><strong>–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞:</strong></p>
                <p>üéÅ <strong>/gift [—ç–º–æ–¥–∑–∏] [–ú–æ–¥–µ–ª—å] [–¥–Ω–∏] [—Ü–µ–Ω–∞] [—Ñ–æ–Ω] [—É–∑–æ—Ä] [–≤–∏–¥–µ–æ]</strong></p>
                <p><em>–ü—Ä–∏–º–µ—Ä: /gift ü¶ç GoldenApe 7 5 gold pattern https://video.com</em></p>
            </div>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="closeModal('botModal')">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let userData = {};
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            const tg = window.Telegram.WebApp;
            tg.expand();
            tg.ready();
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (tg.initDataUnsafe.user) {
                userData = {
                    id: tg.initDataUnsafe.user.id,
                    firstName: tg.initDataUnsafe.user.first_name,
                    lastName: tg.initDataUnsafe.user.last_name,
                    username: tg.initDataUnsafe.user.username
                };
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∞
                if (userData.id.toString() === CONFIG.ADMIN_ID) {
                    document.getElementById('adminBadge').style.display = 'inline';
                }
                
                await updateProfile();
                await authSystem.updateUI(userData.id);
            }
            
            await loadGifts();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
        async function loadGifts() {
            try {
                const gifts = await supabaseClient.getGifts();
                renderGifts(gifts);
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤:", error);
            }
        }
        
        // –ê—Ä–µ–Ω–¥–∞ –ø–æ–¥–∞—Ä–∫–∞
        async function rentGift(giftId) {
            try {
                const result = await supabaseClient.rentGift(giftId, userData.id);
                
                if (result.success) {
                    Telegram.WebApp.showAlert("üéâ –ü–æ–¥–∞—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ –∞—Ä–µ–Ω–¥–æ–≤–∞–Ω!");
                    await updateProfile();
                } else {
                    Telegram.WebApp.showAlert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞—Ä–µ–Ω–¥–µ");
                }
            } catch (error) {
                Telegram.WebApp.showAlert("‚ùå –û—à–∏–±–∫–∞: " + error.message);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        async function updateProfile() {
            if (!userData.id) return;
            
            try {
                const stats = await supabaseClient.getUserStats(userData.id);
                const userInfo = await supabaseClient.getUserData(userData.id);
                
                document.getElementById('userName').textContent = 
                    userData.firstName + (userData.lastName ? ' ' + userData.lastName : '');
                document.getElementById('balance').textContent = stats.balance + ' TON';
                document.getElementById('rentedGifts').textContent = stats.rentedGifts;
                
                if (userInfo?.phone) {
                    document.getElementById('phoneDisplay').textContent = userInfo.phone;
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:", error);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
        function showBotCommands() {
            document.getElementById('botModal').style.display = 'flex';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
